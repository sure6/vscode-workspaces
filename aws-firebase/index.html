<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="manifest" href="manifest.json">
  <title>Welcome to AWS Firebase </title>
</head>

<body>
  <h2>Hello AWS Connect Firebase Cloud Messaging</h2>
  <script type="module">
    // Import the functions you need from the SDKs you need
    import "https://www.gstatic.com/firebasejs/8.2.1/firebase-app.js";
    import "https://www.gstatic.com/firebasejs/8.2.1/firebase-messaging.js";
    // TODO: Add SDKs for Firebase products that you want to use
    // https://firebase.google.com/docs/web/setup#available-libraries

    // Your web app's Firebase configuration
    // For Firebase JS SDK v7.20.0 and later, measurementId is optional
    const firebaseConfig = {
      apiKey: "AIzaSyB3jgj1BmeLLtET6UETMMqAIWttfKv013s",
      authDomain: "myfoodchoice-7f6a0.firebaseapp.com",
      projectId: "myfoodchoice-7f6a0",
      storageBucket: "myfoodchoice-7f6a0.appspot.com",
      messagingSenderId: "626716661579",
      appId: "1:626716661579:web:7464ca549524e9f3957ace",
      measurementId: "G-CV402Q1KB3"
    };

    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    const messaging = firebase.messaging();
    messaging.requestPermission().then(() =>{
      console.log("GRANTED");
      return messaging.getToken();
    }).then(token=>{
      console.log("ðŸš€ ~ file: index.html:183 ~ token:", token)
    }).catch( err=> {
      console.log('Error Occurred.' + err)
    });

    messaging.onMessage( (payload) =>{
      console.log('onMessage: ', payload);
    });

    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('./firebase-messaging-sw.js')
        .then( (registration) =>{
          console.log('Registration successful, scope is:', registration.scope);
        }).catch((err)=>{
          console.log('Service worker registration failed, error:', err);
        });
    }

    // messaging.setBackgroundMessageHandler(function (payload) {
    //   const title = "Hello World";
    //   const option = { body: payload.data.status }
    //   return self.registration.showNotification(title, option);
    // });

    messaging.getToken({ vapidKey: 'BAJp4bIdgumHK1vEzWllDjFsQIJ317n5sX4bnJQykA9mlNEqgzkiD01obWg_tRZM8bGSrNSFSrPHLf0sogOv_Q8' }).then((currentToken) => {
      if (currentToken) {
        // Send the token to your server and update the UI if necessary
        // ...
        console.log(currentToken);
        // messaging.getMessaging().subscribeToTopic(currentToken, topic)
        //   .then((response) => {
        //     // See the MessagingTopicManagementResponse reference documentation
        //     // for the contents of response.
        //     console.log('Successfully subscribed to topic:', response);
        //   })
        //   .catch((error) => {
        //     console.log('Error subscribing to topic:', error);
        //   });
      } else {
        // Show permission request UI
        console.log('No registration token available. Request permission to generate one.');
        // ...
      }
    }).catch((err) => {
      console.log('An error occurred while retrieving token. ', err);
      // ...
    });

  </script>
</body>

</html>